CREATE TABLE FABRICANTE_LOTE (
    ID INTEGER GENERATED BY DEFAULT AS IDENTITY,
    ID_NF INTEGER NOT NULL,
    ID_PRODUTO INTEGER NOT NULL,
    LOTE VARCHAR(100) NOT NULL,
    DT_PRODUCAO DATE,
    DT_VALIDADE DATE,
    QTDE NUMERIC(15,4) NOT NULL,
    QTDE_DISPONIVEL NUMERIC(15,4) NOT NULL);

ALTER TABLE FABRICANTE_LOTE
ADD CONSTRAINT PK_FABRICANTE_LOTE
PRIMARY KEY (ID);

ALTER TABLE FABRICANTE_LOTE
ADD CONSTRAINT FK_FABRICANTE_LOTE_1
FOREIGN KEY (ID_NF)
REFERENCES NOTA_ENTRADA(ID)
ON DELETE CASCADE
ON UPDATE CASCADE;

ALTER TABLE FABRICANTE_LOTE
ADD CONSTRAINT FK_FABRICANTE_LOTE_2
FOREIGN KEY (ID_PRODUTO)
REFERENCES PRODUTO(CODIGO)
ON DELETE CASCADE
ON UPDATE CASCADE;

CREATE TABLE LOTE_MATPRIMA_FABRICANTE (
    ID INTEGER GENERATED BY DEFAULT AS IDENTITY,
    ID_LOTEMATPRIMA INTEGER NOT NULL,
    ID_LOTEFABRICANTE INTEGER NOT NULL,
    QTDE NUMERIC(15,4) NOT NULL);

ALTER TABLE LOTE_MATPRIMA_FABRICANTE
ADD CONSTRAINT PK_LOTE_MATPRIMA_FABRICANTE
PRIMARY KEY (ID);

ALTER TABLE LOTE_MATPRIMA_FABRICANTE
ADD CONSTRAINT FK_LOTE_MATPRIMA_FABRICANTE_1
FOREIGN KEY (ID_LOTEMATPRIMA)
REFERENCES LOTE_MATPRIMA(ID)
ON DELETE CASCADE
ON UPDATE CASCADE;

ALTER TABLE LOTE_MATPRIMA_FABRICANTE
ADD CONSTRAINT FK_LOTE_MATPRIMA_FABRICANTE_2
FOREIGN KEY (ID_LOTEFABRICANTE)
REFERENCES FABRICANTE_LOTE(ID)
ON DELETE CASCADE
ON UPDATE CASCADE;

GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON CAIXA TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON CAIXA_ABERT_FECH TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON CAIXA_APURACAO_VALORES TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON CAIXA_ENT_SAI TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON CEST TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON CFOP TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON CHEQUE TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON CIDADE TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON CLIENTE TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON CONDPAGTO TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON CONTAS_A_RECEBER TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON CONTAS_A_RECEBER_LOG TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON CONTA_BANCARIA TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON CONTROL TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON DEL_PDV_RECEBER TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON EMPRESA TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON ESTADO TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON FABRICANTE TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON FABRICANTE_LOTE TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON FUNCIONARIO TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON GRUPO_FABRICANTE TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON GRUPO_PROD TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON HISTORICO TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON HISTORICO_GRUPO TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON LANCAMENTO TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON LOG_BAIXA_RESTAURA TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON LOTE TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON LOTE_ITENS TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON LOTE_MATPRIMA TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON LOTE_MATPRIMA_FABRICANTE TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON NATOPERACAO TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON NCM TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON NOTA_ENTRADA TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON NOTA_ENTRADA_ANEXO TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON NOTA_ENTRADA_ITENS TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON NOTA_ENTRADA_PAGAR TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON NOTA_ENTRADA_PARCIAL TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON ORCAMENTO TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON ORCAMENTO_ITEM TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON ORCAMENTO_PAGTO TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON PAGTO_FORMA TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON PAGTO_PARCELAMENTO TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON PAIS TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON PDV_CANCELAMENTO TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON PDV_DEVOLUCAO TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON PDV_ITENS TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON PDV_MASTER TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON PDV_RECEBER TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON PDV_RECEBER_PARCIAL TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON PEDIDO_VENDA TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON PEDIDO_VENDA_IMG TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON PEDIDO_VENDA_ITEM TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON PEDIDO_VENDA_STATUS TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON PRECOCUSTO_HISTORICO TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON PRECOVENDA_HISTORICO TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON PRODUTO TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON PRODUTO_COMPOSICAO TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON PRODUTO_FORNECEDOR TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON RAMO_ATIVIDADE TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON REPRESENTANTE TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON SUBGRUPO_PROD TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON TRANSPORTADORA TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON UNIDADE TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON USUARIO TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON USUARIO_GRUPO TO R_SISTEMA;
GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON VW_FORMAPAGTO TO R_SISTEMA;
GRANT EXECUTE ON PROCEDURE PRO_ENTRADA_SAIDA TO R_SISTEMA;
GRANT EXECUTE ON PROCEDURE PRO_GET_SCRIPT TO R_SISTEMA;
GRANT EXECUTE ON PROCEDURE PRO_HIST_PRECOCUSTO TO R_SISTEMA;
GRANT EXECUTE ON PROCEDURE PRO_HIST_PRECOVENDA TO R_SISTEMA;
GRANT EXECUTE ON PROCEDURE PRO_ISCREDIARIO TO R_SISTEMA;
GRANT EXECUTE ON PROCEDURE PRO_MOVIMENTOPRODUTO TO R_SISTEMA;
GRANT EXECUTE ON PROCEDURE PRO_RECEBER_VLLIQ TO R_SISTEMA;
GRANT EXECUTE ON PROCEDURE PRO_SONUMEROS TO R_SISTEMA;
GRANT EXECUTE ON PROCEDURE PRO_TOT_DUPLICATAS TO R_SISTEMA;
GRANT EXECUTE ON PROCEDURE PRO_ULTIMAVENDA TO R_SISTEMA;
GRANT EXECUTE ON PROCEDURE PRO_UPDATE_DEBITO_CLIENTE TO R_SISTEMA;
GRANT EXECUTE ON PROCEDURE PRO_UPD_PRODUTO_CUSTO TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_ATENDIMENTO_ID TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_CAIXA TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_CAIXA_ABERT_FECH TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_CAIXA_APURACAO_VALORES TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_CAIXA_ENT_SAI TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_CEST_ID TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_CIDADES_ID TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_CLIENTE TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_CONDPAGTO TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_CONTABANCARIA TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_HISTORICO TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_HISTORICO_GRUPO TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_HIS_PRECOCUSTO TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_LANCAMENTO TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_LOTE TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_LOTE_ITENS TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_LOTE_MATPRIMA TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_NCM_ID TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_NOTAENTRADA TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_NOTAENTRADA_ITENS TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_ORCAMENTO TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_PAGTOFORMA TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_PAGTOPARCELAMENTO TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_PEDIDOVENDA TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_PRAZO_PAGAMENTO_ID TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_PRAZO_PAGAMENTO_PARCELA_ID TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_PRECOHISTORICO TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_PRODUTO TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_RECEBER_PARCIAL TO R_SISTEMA;
GRANT USAGE ON SEQUENCE GEN_UNIDADE TO R_SISTEMA;

ALTER TABLE LOTE DROP ID_PEDIDO;

ALTER TABLE LOTE DROP VALIDADE

ALTER TABLE LOTE DROP ENTREGA;

ALTER TABLE LOTE DROP ESTIMATIVA_PRONTO;

ALTER TABLE LOTE
    ADD DT_FIM_PRODUCAO DATE;

alter table LOTE
alter ID position 1;

alter table LOTE
alter LOTE position 2;

alter table LOTE
alter EMISSAO position 3;

alter table LOTE
alter DT_FIM_PRODUCAO position 4;

alter table LOTE
alter OBS position 5;

alter table LOTE
alter STATUS position 6;

alter table LOTE
alter GERA_MATPRIMA position 7;

alter table LOTE
alter USUARIO position 8;

alter table LOTE
alter LOTE_ACERTO position 9;

alter table LOTE
alter AUTORIZACAO position 10;

ALTER TABLE LOTE_ITENS
    ADD DT_VALIDADE DATE;

ALTER TABLE LOTE_ITENS
    ADD VL_CUSTO NUMERIC(10,2);

